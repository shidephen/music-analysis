<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>AudioProcessor</title>
    <meta name="keywords" content="at.ofai.music.beatroot.AudioProcessor,AudioProcessor class" />
    <meta name="generator" content="SinjDoc 0.5" />
    <link href="../../../../stylesheet.css" rel="stylesheet" type="text/css" />
    <link rel="Index" href="../../../../index-all.html" />
    <link rel="Start" href="../../../../overview-summary.html" />
    <link rel="Up" href="package-summary.html" />
    <link rel="Help" href="../../../../help-doc.html" />
  </head>
  <body class="classPage bigframe">
   <div class="navbar">
    <p class="nav navtop">
      <span class="over"><a href="../../../../overview-summary.html">Overview</a></span>
      <span class="package"><a href="package-summary.html">Package</a></span>
      <span class="class selected">Class</span>
      <span class="use"><a href="class-use/AudioProcessor.html">Use</a></span>
      <span class="tree"><a href="package-tree.html">Tree</a></span>
      <span class="deprecated"><a href="../../../../deprecated-list.html">Deprecated</a></span>
      <span class="index"><a href="../../../../index-all.html">Index</a></span>
      <span class="help"><a href="../../../../help-doc.html">Help</a></span>
    </p>
    <p class="nav navmid">
      <span class="prevnext">
       <span class="prev">Prev Class</span>
       <span class="next">Next Class</span>
      </span>
      <span class="framesel">
       <span class="frames"><a href="../../../../index.html" target="_top">Frames</a></span>
       <span class="noframes"><a href="AudioProcessor.html" target="_top">NoFrames</a></span>
      </span>
      <span class="allclasses"><a href="../../../../allclasses-noframe.html">All Classes</a></span>
   </p>
   <p class="nav navbot">
      <span class="summary">Summary:
       <span class="nested">Nested</span>
       <span class="field"><a href="#field_summary">Field</a></span>
       <span class="constr"><a href="#constructor_summary">Constr</a></span>
       <span class="method"><a href="#method_summary">Method</a></span>
      </span>
      <span class="detail">Detail:
       <span class="field"><a href="#field_detail">Field</a></span>
       <span class="constr"><a href="#constructor_detail">Constr</a></span>
       <span class="method"><a href="#method_detail">Method</a></span>
      </span>
   </p>
    <div class="navtitle">
     
    </div>
    <p class="clear"><!--empty--></p>
   </div>
   <p class="packageName">at.ofai.music.beatroot</p>
   <h1>  Class  AudioProcessor</h1>
<!--
   <p class="enclosing">
   Enclosing class/interface: @OUTER@
   </p>
-->


   <!-- XXX class hierarchy diagram goes here -->
<!--
   
   <p class="directSubclasses">
   Direct known subclasses: @ALL_SUBCLASSES@
   </p>
-->


   <p class="declaration">public
     class 
   <span class="className">AudioProcessor</span>
   
   
      
      <span class="extends">extends Object</span>
      
      
   
   </p>

   <div class="description">
    Audio processing class (adapted from PerformanceMatcher).
   </div>




   <table class="field_summary summary">
     <tr><th colspan="2"><a name="field_summary" id="field_summary">Field Summary</a></th></tr>

     <tr><td>protected String</td><td><span class="memberName"><a href="#audioFileName" class="fieldRef">audioFileName</a></span><div class="memberDescription"> Source of input data.
  </div></td></tr>



     <tr><td>protected AudioFormat</td><td><span class="memberName"><a href="#audioFormat" class="fieldRef">audioFormat</a></span><div class="memberDescription"> Format of the audio data in <code>pcmInputStream</code></div></td></tr>



     <tr><td>protected SourceDataLine</td><td><span class="memberName"><a href="#audioOut" class="fieldRef">audioOut</a></span><div class="memberDescription"> Line for audio output (not used, since output is done by AudioPlayer)</div></td></tr>



     <tr><td>static boolean</td><td><span class="memberName"><a href="#batchMode" class="fieldRef">batchMode</a></span><div class="memberDescription"> Flag for batch mode.</div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#cbIndex" class="fieldRef">cbIndex</a></span><div class="memberDescription"> The index of the next position to write in the circular buffer.</div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#channels" class="fieldRef">channels</a></span><div class="memberDescription"> Number of channels of audio in <code>audioFormat</code></div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#circBuffer" class="fieldRef">circBuffer</a></span><div class="memberDescription"> Audio data is scaled to the range [0,1] and averaged to one channel and
  stored in a circular buffer for reuse (if hopTime &lt; fftTime).</div></td></tr>



     <tr><td>static boolean</td><td><span class="memberName"><a href="#debug" class="fieldRef">debug</a></span><div class="memberDescription"> Flag for enabling or disabling debugging output</div></td></tr>



     <tr><td>static boolean</td><td><span class="memberName"><a href="#doOnsetPlot" class="fieldRef">doOnsetPlot</a></span><div class="memberDescription"> Flag for plotting onset detection function.</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#energy" class="fieldRef">energy</a></span><div class="memberDescription"> The RMS energy of all frames.</div></td></tr>



     <tr><td>static int</td><td><span class="memberName"><a href="#energyOversampleFactor" class="fieldRef">energyOversampleFactor</a></span><div class="memberDescription"> Ratio between rate of sampling the signal energy (for the amplitude envelope) and the hop size</div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#fftSize" class="fieldRef">fftSize</a></span><div class="memberDescription"> The size of an FFT frame in samples (see <code>fftTime</code>)</div></td></tr>



     <tr><td>protected double</td><td><span class="memberName"><a href="#fftTime" class="fieldRef">fftTime</a></span><div class="memberDescription"> The approximate size of an FFT frame in seconds, as set by the command
  line option <b>-f FFTTime</b>. </div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#frameCount" class="fieldRef">frameCount</a></span><div class="memberDescription"> The number of overlapping frames of audio data which have been read.</div></td></tr>



     <tr><td>protected double</td><td><span class="memberName"><a href="#frameRMS" class="fieldRef">frameRMS</a></span><div class="memberDescription"> RMS amplitude of the current frame.</div></td></tr>



     <tr><td>protected double[][]</td><td><span class="memberName"><a href="#frames" class="fieldRef">frames</a></span><div class="memberDescription"> The magnitude spectra of all frames, used for plotting the spectrogram.</div></td></tr>



     <tr><td>protected int[]</td><td><span class="memberName"><a href="#freqMap" class="fieldRef">freqMap</a></span><div class="memberDescription"> A mapping function for mapping FFT bins to final frequency bins.
  </div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#freqMapSize" class="fieldRef">freqMapSize</a></span><div class="memberDescription"> The number of entries in <code>freqMap</code>. </div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#hopSize" class="fieldRef">hopSize</a></span><div class="memberDescription"> Spacing of audio frames in samples (see <code>hopTime</code>)</div></td></tr>



     <tr><td>protected double</td><td><span class="memberName"><a href="#hopTime" class="fieldRef">hopTime</a></span><div class="memberDescription"> Spacing of audio frames (determines the amount of overlap or skip
  between frames). </div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#imBuffer" class="fieldRef">imBuffer</a></span><div class="memberDescription"> The imaginary part of the data for the in-place FFT computation.
  </div></td></tr>



     <tr><td>protected byte[]</td><td><span class="memberName"><a href="#inputBuffer" class="fieldRef">inputBuffer</a></span><div class="memberDescription"> Audio data is initially read in PCM format into this buffer.</div></td></tr>



     <tr><td>static int</td><td><span class="memberName"><a href="#liveInputBufferSize" class="fieldRef">liveInputBufferSize</a></span><div class="memberDescription"> Audio buffer for live input. </div></td></tr>



     <tr><td>protected double</td><td><span class="memberName"><a href="#ltAverage" class="fieldRef">ltAverage</a></span><div class="memberDescription"> Long term average frame energy (in frequency domain representation).</div></td></tr>



     <tr><td>static int</td><td><span class="memberName"><a href="#MAX_LENGTH" class="fieldRef">MAX_LENGTH</a></span><div class="memberDescription"> Maximum file length in seconds. </div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#newFrame" class="fieldRef">newFrame</a></span><div class="memberDescription"> The magnitude spectrum of the current frame.</div></td></tr>



     <tr><td>static int</td><td><span class="memberName"><a href="#normaliseMode" class="fieldRef">normaliseMode</a></span><div class="memberDescription"> Determines method of normalisation. </div></td></tr>



     <tr><td>protected EventList</td><td><span class="memberName"><a href="#onsetList" class="fieldRef">onsetList</a></span><div class="memberDescription"> The estimated onset times and their saliences.</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#onsets" class="fieldRef">onsets</a></span><div class="memberDescription"> The estimated onset times from peak-picking the onset detection function(s).</div></td></tr>



     <tr><td>protected AudioInputStream</td><td><span class="memberName"><a href="#pcmInputStream" class="fieldRef">pcmInputStream</a></span><div class="memberDescription"> Uncompressed version of <code>rawInputStream</code>.
  </div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#phaseDeviation" class="fieldRef">phaseDeviation</a></span><div class="memberDescription"> Phase deviation onset detection function, indexed by frame.</div></td></tr>



     <tr><td> Plot</td><td><span class="memberName"><a href="#plot" class="fieldRef">plot</a></span><div class="memberDescription"> Object for plotting output (for debugging / development) .</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#prevFrame" class="fieldRef">prevFrame</a></span><div class="memberDescription"> The magnitude spectrum of the most recent frame.
  </div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#prevPhase" class="fieldRef">prevPhase</a></span><div class="memberDescription"> Phase of the previous frame, for calculating an onset function
  based on spectral phase deviation.</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#prevPrevPhase" class="fieldRef">prevPrevPhase</a></span><div class="memberDescription"> Phase of the frame before the previous frame, for calculating an
  onset function based on spectral phase deviation.</div></td></tr>



     <tr><td>protected <a href="ProgressIndicator.html" class="interfaceRef">ProgressIndicator</a></td><td><span class="memberName"><a href="#progressCallback" class="fieldRef">progressCallback</a></span><div class="memberDescription"> GUI component which shows progress of audio processing.</div></td></tr>



     <tr><td>static double</td><td><span class="memberName"><a href="#rangeThreshold" class="fieldRef">rangeThreshold</a></span><div class="memberDescription"> For dynamic range compression, this value is added to the log magnitude
  in each frequency bin and any remaining negative values are then set to zero.</div></td></tr>



     <tr><td>protected AudioInputStream</td><td><span class="memberName"><a href="#rawInputStream" class="fieldRef">rawInputStream</a></span><div class="memberDescription"> Input data stream for this performance (possibly in compressed format)</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#reBuffer" class="fieldRef">reBuffer</a></span><div class="memberDescription"> The real part of the data for the in-place FFT computation.
  </div></td></tr>



     <tr><td>protected float</td><td><span class="memberName"><a href="#sampleRate" class="fieldRef">sampleRate</a></span><div class="memberDescription"> Sample rate of audio in <code>audioFormat</code></div></td></tr>



     <tr><td>static double</td><td><span class="memberName"><a href="#silenceThreshold" class="fieldRef">silenceThreshold</a></span><div class="memberDescription"> RMS frame energy below this value results in the frame being set to zero,
  so that normalisation does not have undesired side-effects.</div></td></tr>



     <tr><td>protected static boolean</td><td><span class="memberName"><a href="#silent" class="fieldRef">silent</a></span><div class="memberDescription"> Flag for suppressing all standard output messages except results.</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#spectralFlux" class="fieldRef">spectralFlux</a></span><div class="memberDescription"> Spectral flux onset detection function, indexed by frame.</div></td></tr>



     <tr><td> BufferedReader</td><td><span class="memberName"><a href="#stdIn" class="fieldRef">stdIn</a></span><div class="memberDescription"> Standard input for interactive prompts (for debugging).</div></td></tr>



     <tr><td>protected int</td><td><span class="memberName"><a href="#totalFrames" class="fieldRef">totalFrames</a></span><div class="memberDescription"> Total number of audio frames if known, or -1 for live or compressed input.</div></td></tr>



     <tr><td>protected double[]</td><td><span class="memberName"><a href="#window" class="fieldRef">window</a></span><div class="memberDescription"> The window function for the STFT, currently a Hamming window.</div></td></tr>

   </table>




   <table class="constructor_summary summary">
     <tr><th colspan="2"><a name="constructor_summary" id="constructor_summary">Constructor Summary</a></th></tr>

     <tr><td> </td><td><span class="memberName"><a href="#AudioProcessor()" class="constructorRef">AudioProcessor</a>()</span><div class="memberDescription"> Constructor: note that streams are not opened until the input file is set
  (see <code>setInputFile()</code>).</div></td></tr>

   </table>




   <table class="method_summary summary">
     <tr><th colspan="2"><a name="method_summary" id="method_summary">Method Summary</a></th></tr>

     <tr><td>  void</td><td><span class="memberName"><a href="#closeStreams()" class="methodRef">closeStreams</a>()</span><div class="memberDescription"> Closes the input stream(s) associated with this object.</div></td></tr>



     <tr><td>static  double[]</td><td><span class="memberName"><a href="#getFeatures(<unknown>.String)" class="methodRef">getFeatures</a>(String fileName)</span><div class="memberDescription"> Reads a text file containing a list of whitespace-separated feature values.
  </div></td></tr>



     <tr><td>  boolean</td><td><span class="memberName"><a href="#getFrame()" class="methodRef">getFrame</a>()</span><div class="memberDescription"> Reads a frame of input data, averages the channels to mono, scales
  to a maximum possible absolute value of 1, and stores the audio data
  in a circular input buffer.</div></td></tr>



     <tr><td>protected  void</td><td><span class="memberName"><a href="#init()" class="methodRef">init</a>()</span><div class="memberDescription"> Allocates memory for arrays, based on parameter settings</div></td></tr>



     <tr><td>protected  void</td><td><span class="memberName"><a href="#makeFreqMap(int,float)" class="methodRef">makeFreqMap</a>(int fftSize, float sampleRate)</span><div class="memberDescription"> Creates a map of FFT frequency bins to comparison bins.
  </div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#print()" class="methodRef">print</a>()</span><div class="memberDescription"> For debugging, outputs information about the AudioProcessor to
  standard error.</div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#processFeatures(<unknown>.String,double)" class="methodRef">processFeatures</a>(String fileName, double hopTime)</span><div class="memberDescription"> Reads a file of feature values, treated as an onset detection function,
  and finds peaks, which are stored in <code>onsetList</code> and <code>onsets</code>.</div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#processFile()" class="methodRef">processFile</a>()</span><div class="memberDescription"> Processes a complete file of audio data.</div></td></tr>



     <tr><td>protected  void</td><td><span class="memberName"><a href="#processFrame()" class="methodRef">processFrame</a>()</span><div class="memberDescription"> Processes a frame of audio data by first computing the STFT with a
  Hamming window, then mapping the frequency bins into a part-linear
  part-logarithmic array, then computing the spectral flux 
  then (optionally) normalising and calculating onsets.</div></td></tr>



     <tr><td>  String</td><td><span class="memberName"><a href="#readLine()" class="methodRef">readLine</a>()</span><div class="memberDescription"> For interactive pause - wait for user to hit Enter</div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#setDisplay(at.ofai.music.beatroot.BeatTrackDisplay)" class="methodRef">setDisplay</a>(<a href="BeatTrackDisplay.html" class="classRef">BeatTrackDisplay</a> btd)</span><div class="memberDescription"> Copies output of audio processing to the display panel.</div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#setInputFile(<unknown>.String)" class="methodRef">setInputFile</a>(String fileName)</span><div class="memberDescription"> Sets up the streams and buffers for audio file input.
  </div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#setLiveInput()" class="methodRef">setLiveInput</a>()</span><div class="memberDescription"> Sets up the streams and buffers for live audio input (CD quality).
  </div></td></tr>



     <tr><td>  void</td><td><span class="memberName"><a href="#setProgressCallback(at.ofai.music.beatroot.ProgressIndicator)" class="methodRef">setProgressCallback</a>(<a href="ProgressIndicator.html" class="interfaceRef">ProgressIndicator</a> c)</span><div class="memberDescription"> Adds a link to the GUI component which shows the progress of matching.</div></td></tr>



     <tr><td>  String</td><td><span class="memberName"><a href="#toString()" class="methodRef">toString</a>()</span><div class="memberDescription"> Gives some basic information about the audio being processed.</div></td></tr>



     <tr><td>protected  void</td><td><span class="memberName"><a href="#weightedPhaseDeviation()" class="methodRef">weightedPhaseDeviation</a>()</span><div class="memberDescription"> Calculates the weighted phase deviation onset detection function.
  </div></td></tr>

   </table>



<!--
   <p class="inherited">
    <span class="header">Methods inherited from class java.util.<a
   href="AbstractCollection.html">AbstractCollection</a></span>
    <a href="#addAll">addAll</a>
    <a href="#contains">contains</a>
   </p>
   <p class="inherited">
    <span class="header">Methods inherited from class java.lang.<a
   href="Object.html">Object</a></span>
    <a href="#addAll">clone</a>
    <a href="#contains">finalize</a>
   </p>
   <p class="inherited">
    <span class="header">Methods inherited from interface java.util.<a
   href="List.html">List</a></span>
    <a href="#addAll">addAll</a>
    <a href="#contains">contains</a>
   </p>
-->



   <h2><a name="field_detail" id="field_detail">Field Detail</a></h2>

   <h3><a name="audioFileName" id="audioFileName">audioFileName</a></h3>
   <div class="memberName">protected String audioFileName</div>
   <div class="memberDescription"> Source of input data.
  Could be extended to include live input from the sound card.</div>


   <h3><a name="audioFormat" id="audioFormat">audioFormat</a></h3>
   <div class="memberName">protected AudioFormat audioFormat</div>
   <div class="memberDescription"> Format of the audio data in <code>pcmInputStream</code></div>


   <h3><a name="audioOut" id="audioOut">audioOut</a></h3>
   <div class="memberName">protected SourceDataLine audioOut</div>
   <div class="memberDescription"> Line for audio output (not used, since output is done by AudioPlayer)</div>


   <h3><a name="batchMode" id="batchMode">batchMode</a></h3>
   <div class="memberName">public static boolean batchMode</div>
   <div class="memberDescription"> Flag for batch mode.</div>


   <h3><a name="cbIndex" id="cbIndex">cbIndex</a></h3>
   <div class="memberName">protected int cbIndex</div>
   <div class="memberDescription"> The index of the next position to write in the circular buffer.</div>


   <h3><a name="channels" id="channels">channels</a></h3>
   <div class="memberName">protected int channels</div>
   <div class="memberDescription"> Number of channels of audio in <code>audioFormat</code></div>


   <h3><a name="circBuffer" id="circBuffer">circBuffer</a></h3>
   <div class="memberName">protected double[] circBuffer</div>
   <div class="memberDescription"> Audio data is scaled to the range [0,1] and averaged to one channel and
  stored in a circular buffer for reuse (if hopTime &lt; fftTime).</div>


   <h3><a name="debug" id="debug">debug</a></h3>
   <div class="memberName">public static boolean debug</div>
   <div class="memberDescription"> Flag for enabling or disabling debugging output</div>


   <h3><a name="doOnsetPlot" id="doOnsetPlot">doOnsetPlot</a></h3>
   <div class="memberName">public static boolean doOnsetPlot</div>
   <div class="memberDescription"> Flag for plotting onset detection function.</div>


   <h3><a name="energy" id="energy">energy</a></h3>
   <div class="memberName">protected double[] energy</div>
   <div class="memberDescription"> The RMS energy of all frames.</div>


   <h3><a name="energyOversampleFactor" id="energyOversampleFactor">energyOversampleFactor</a></h3>
   <div class="memberName">public static int energyOversampleFactor</div>
   <div class="memberDescription"> Ratio between rate of sampling the signal energy (for the amplitude envelope) and the hop size</div>


   <h3><a name="fftSize" id="fftSize">fftSize</a></h3>
   <div class="memberName">protected int fftSize</div>
   <div class="memberDescription"> The size of an FFT frame in samples (see <code>fftTime</code>)</div>


   <h3><a name="fftTime" id="fftTime">fftTime</a></h3>
   <div class="memberName">protected double fftTime</div>
   <div class="memberDescription"> The approximate size of an FFT frame in seconds, as set by the command
  line option <b>-f FFTTime</b>. (Default = 0.04644s).  The value is
  adjusted so that <code>fftSize</code> is always power of 2.</div>


   <h3><a name="frameCount" id="frameCount">frameCount</a></h3>
   <div class="memberName">protected int frameCount</div>
   <div class="memberDescription"> The number of overlapping frames of audio data which have been read.</div>


   <h3><a name="frameRMS" id="frameRMS">frameRMS</a></h3>
   <div class="memberName">protected double frameRMS</div>
   <div class="memberDescription"> RMS amplitude of the current frame.</div>


   <h3><a name="frames" id="frames">frames</a></h3>
   <div class="memberName">protected double[][] frames</div>
   <div class="memberDescription"> The magnitude spectra of all frames, used for plotting the spectrogram.</div>


   <h3><a name="freqMap" id="freqMap">freqMap</a></h3>
   <div class="memberName">protected int[] freqMap</div>
   <div class="memberDescription"> A mapping function for mapping FFT bins to final frequency bins.
  The mapping is linear (1-1) until the resolution reaches 2 points per
  semitone, then logarithmic with a semitone resolution.  e.g. for
  44.1kHz sampling rate and fftSize of 2048 (46ms), bin spacing is
  21.5Hz, which is mapped linearly for bins 0-34 (0 to 732Hz), and
  logarithmically for the remaining bins (midi notes 79 to 127, bins 35 to
  83), where all energy above note 127 is mapped into the final bin.</div>


   <h3><a name="freqMapSize" id="freqMapSize">freqMapSize</a></h3>
   <div class="memberName">protected int freqMapSize</div>
   <div class="memberDescription"> The number of entries in <code>freqMap</code>. Note that the length of
  the array is greater, because its size is not known at creation time.</div>


   <h3><a name="hopSize" id="hopSize">hopSize</a></h3>
   <div class="memberName">protected int hopSize</div>
   <div class="memberDescription"> Spacing of audio frames in samples (see <code>hopTime</code>)</div>


   <h3><a name="hopTime" id="hopTime">hopTime</a></h3>
   <div class="memberName">protected double hopTime</div>
   <div class="memberDescription"> Spacing of audio frames (determines the amount of overlap or skip
  between frames). This value is expressed in seconds and can be set by
  the command line option <b>-h hopTime</b>. (Default = 0.020s)</div>


   <h3><a name="imBuffer" id="imBuffer">imBuffer</a></h3>
   <div class="memberName">protected double[] imBuffer</div>
   <div class="memberDescription"> The imaginary part of the data for the in-place FFT computation.
  Since input data is real, this initially contains zeros.</div>


   <h3><a name="inputBuffer" id="inputBuffer">inputBuffer</a></h3>
   <div class="memberName">protected byte[] inputBuffer</div>
   <div class="memberDescription"> Audio data is initially read in PCM format into this buffer.</div>


   <h3><a name="liveInputBufferSize" id="liveInputBufferSize">liveInputBufferSize</a></h3>
   <div class="memberName">public static final int liveInputBufferSize</div>
   <div class="memberDescription"> Audio buffer for live input. (Not used yet)</div>


   <h3><a name="ltAverage" id="ltAverage">ltAverage</a></h3>
   <div class="memberName">protected double ltAverage</div>
   <div class="memberDescription"> Long term average frame energy (in frequency domain representation).</div>


   <h3><a name="MAX_LENGTH" id="MAX_LENGTH">MAX_LENGTH</a></h3>
   <div class="memberName">public static final int MAX_LENGTH</div>
   <div class="memberDescription"> Maximum file length in seconds. Used for static allocation of arrays.</div>


   <h3><a name="newFrame" id="newFrame">newFrame</a></h3>
   <div class="memberName">protected double[] newFrame</div>
   <div class="memberDescription"> The magnitude spectrum of the current frame.</div>


   <h3><a name="normaliseMode" id="normaliseMode">normaliseMode</a></h3>
   <div class="memberName">public static int normaliseMode</div>
   <div class="memberDescription"> Determines method of normalisation. Values can be:<ul>
  <li>0: no normalisation</li>
  <li>1: normalisation by current frame energy</li>
  <li>2: normalisation by exponential average of frame energy</li>
  </ul></div>


   <h3><a name="onsetList" id="onsetList">onsetList</a></h3>
   <div class="memberName">protected EventList onsetList</div>
   <div class="memberDescription"> The estimated onset times and their saliences.</div>


   <h3><a name="onsets" id="onsets">onsets</a></h3>
   <div class="memberName">protected double[] onsets</div>
   <div class="memberDescription"> The estimated onset times from peak-picking the onset detection function(s).</div>


   <h3><a name="pcmInputStream" id="pcmInputStream">pcmInputStream</a></h3>
   <div class="memberName">protected AudioInputStream pcmInputStream</div>
   <div class="memberDescription"> Uncompressed version of <code>rawInputStream</code>.
  In the (normal) case where the input is already PCM data,
  <code>rawInputStream == pcmInputStream</code></div>


   <h3><a name="phaseDeviation" id="phaseDeviation">phaseDeviation</a></h3>
   <div class="memberName">protected double[] phaseDeviation</div>
   <div class="memberDescription"> Phase deviation onset detection function, indexed by frame.</div>


   <h3><a name="plot" id="plot">plot</a></h3>
   <div class="memberName"> Plot plot</div>
   <div class="memberDescription"> Object for plotting output (for debugging / development) .</div>


   <h3><a name="prevFrame" id="prevFrame">prevFrame</a></h3>
   <div class="memberName">protected double[] prevFrame</div>
   <div class="memberDescription"> The magnitude spectrum of the most recent frame.
  Used for calculating the spectral flux.</div>


   <h3><a name="prevPhase" id="prevPhase">prevPhase</a></h3>
   <div class="memberName">protected double[] prevPhase</div>
   <div class="memberDescription"> Phase of the previous frame, for calculating an onset function
  based on spectral phase deviation.</div>


   <h3><a name="prevPrevPhase" id="prevPrevPhase">prevPrevPhase</a></h3>
   <div class="memberName">protected double[] prevPrevPhase</div>
   <div class="memberDescription"> Phase of the frame before the previous frame, for calculating an
  onset function based on spectral phase deviation.</div>


   <h3><a name="progressCallback" id="progressCallback">progressCallback</a></h3>
   <div class="memberName">protected <a href="ProgressIndicator.html" class="interfaceRef">ProgressIndicator</a> progressCallback</div>
   <div class="memberDescription"> GUI component which shows progress of audio processing.</div>


   <h3><a name="rangeThreshold" id="rangeThreshold">rangeThreshold</a></h3>
   <div class="memberName">public static double rangeThreshold</div>
   <div class="memberDescription"> For dynamic range compression, this value is added to the log magnitude
  in each frequency bin and any remaining negative values are then set to zero.</div>


   <h3><a name="rawInputStream" id="rawInputStream">rawInputStream</a></h3>
   <div class="memberName">protected AudioInputStream rawInputStream</div>
   <div class="memberDescription"> Input data stream for this performance (possibly in compressed format)</div>


   <h3><a name="reBuffer" id="reBuffer">reBuffer</a></h3>
   <div class="memberName">protected double[] reBuffer</div>
   <div class="memberDescription"> The real part of the data for the in-place FFT computation.
  Since input data is real, this initially contains the input data.</div>


   <h3><a name="sampleRate" id="sampleRate">sampleRate</a></h3>
   <div class="memberName">protected float sampleRate</div>
   <div class="memberDescription"> Sample rate of audio in <code>audioFormat</code></div>


   <h3><a name="silenceThreshold" id="silenceThreshold">silenceThreshold</a></h3>
   <div class="memberName">public static double silenceThreshold</div>
   <div class="memberDescription"> RMS frame energy below this value results in the frame being set to zero,
  so that normalisation does not have undesired side-effects.</div>


   <h3><a name="silent" id="silent">silent</a></h3>
   <div class="memberName">protected static boolean silent</div>
   <div class="memberDescription"> Flag for suppressing all standard output messages except results.</div>


   <h3><a name="spectralFlux" id="spectralFlux">spectralFlux</a></h3>
   <div class="memberName">protected double[] spectralFlux</div>
   <div class="memberDescription"> Spectral flux onset detection function, indexed by frame.</div>


   <h3><a name="stdIn" id="stdIn">stdIn</a></h3>
   <div class="memberName"> BufferedReader stdIn</div>
   <div class="memberDescription"> Standard input for interactive prompts (for debugging).</div>


   <h3><a name="totalFrames" id="totalFrames">totalFrames</a></h3>
   <div class="memberName">protected int totalFrames</div>
   <div class="memberDescription"> Total number of audio frames if known, or -1 for live or compressed input.</div>


   <h3><a name="window" id="window">window</a></h3>
   <div class="memberName">protected double[] window</div>
   <div class="memberDescription"> The window function for the STFT, currently a Hamming window.</div>




   <h2><a name="constructor_detail" id="constructor_detail">Constructor Detail</a></h2>

   <h3><a name="AudioProcessor()" id="AudioProcessor()">AudioProcessor</a></h3>
   <div class="memberName">public  AudioProcessor()</div>
   <div class="memberDescription"> Constructor: note that streams are not opened until the input file is set
  (see <code>setInputFile()</code>).</div>




   <h2><a name="method_detail" id="method_detail">Method Detail</a></h2>

   <h3><a name="closeStreams()" id="closeStreams()">closeStreams</a></h3>
   <div class="memberName">public  void closeStreams()</div>
   <div class="memberDescription"> Closes the input stream(s) associated with this object.</div>


   <h3><a name="getFeatures(<unknown>.String)" id="getFeatures(<unknown>.String)">getFeatures</a></h3>
   <div class="memberName">public static  double[] getFeatures(String fileName)</div>
   <div class="memberDescription"> Reads a text file containing a list of whitespace-separated feature values.
  Created for paper submitted to ICASSP'07.<p class="tag tag_param"><span class="tagName">Parameters:</span> <span class="tagContents">fileName File containing the data</span> </p>
<p class="tag tag_return"><span class="tagName">Returns:</span> <span class="tagContents">An array containing the feature values</span> </p>
</div>


   <h3><a name="getFrame()" id="getFrame()">getFrame</a></h3>
   <div class="memberName">public  boolean getFrame()</div>
   <div class="memberDescription"> Reads a frame of input data, averages the channels to mono, scales
  to a maximum possible absolute value of 1, and stores the audio data
  in a circular input buffer.<p class="tag tag_return"><span class="tagName">Returns:</span> <span class="tagContents">true if a frame (or part of a frame, if it is the final frame)
  is read. If a complete frame cannot be read, the InputStream is set
  to null.</span> </p>
</div>


   <h3><a name="init()" id="init()">init</a></h3>
   <div class="memberName">protected  void init()</div>
   <div class="memberDescription"> Allocates memory for arrays, based on parameter settings</div>


   <h3><a name="makeFreqMap(int,float)" id="makeFreqMap(int,float)">makeFreqMap</a></h3>
   <div class="memberName">protected  void makeFreqMap(int fftSize, float sampleRate)</div>
   <div class="memberDescription"> Creates a map of FFT frequency bins to comparison bins.
  Where the spacing of FFT bins is less than 0.5 semitones, the mapping is
  one to one. Where the spacing is greater than 0.5 semitones, the FFT
  energy is mapped into semitone-wide bins. No scaling is performed; that
  is the energy is summed into the comparison bins. See also
  processFrame()</div>


   <h3><a name="print()" id="print()">print</a></h3>
   <div class="memberName">public  void print()</div>
   <div class="memberDescription"> For debugging, outputs information about the AudioProcessor to
  standard error.</div>


   <h3><a name="processFeatures(<unknown>.String,double)" id="processFeatures(<unknown>.String,double)">processFeatures</a></h3>
   <div class="memberName">public  void processFeatures(String fileName, double hopTime)</div>
   <div class="memberDescription"> Reads a file of feature values, treated as an onset detection function,
  and finds peaks, which are stored in <code>onsetList</code> and <code>onsets</code>.<p class="tag tag_param"><span class="tagName">Parameters:</span> <span class="tagContents">fileName The file of feature values</span> <span class="tagContents">hopTime The spacing of feature values in time</span> </p>
</div>


   <h3><a name="processFile()" id="processFile()">processFile</a></h3>
   <div class="memberName">public  void processFile()</div>
   <div class="memberDescription"> Processes a complete file of audio data.</div>


   <h3><a name="processFrame()" id="processFrame()">processFrame</a></h3>
   <div class="memberName">protected  void processFrame()</div>
   <div class="memberDescription"> Processes a frame of audio data by first computing the STFT with a
  Hamming window, then mapping the frequency bins into a part-linear
  part-logarithmic array, then computing the spectral flux 
  then (optionally) normalising and calculating onsets.</div>


   <h3><a name="readLine()" id="readLine()">readLine</a></h3>
   <div class="memberName">public  String readLine()</div>
   <div class="memberDescription"> For interactive pause - wait for user to hit Enter</div>


   <h3><a name="setDisplay(at.ofai.music.beatroot.BeatTrackDisplay)" id="setDisplay(at.ofai.music.beatroot.BeatTrackDisplay)">setDisplay</a></h3>
   <div class="memberName">public  void setDisplay(<a href="BeatTrackDisplay.html" class="classRef">BeatTrackDisplay</a> btd)</div>
   <div class="memberDescription"> Copies output of audio processing to the display panel.</div>


   <h3><a name="setInputFile(<unknown>.String)" id="setInputFile(<unknown>.String)">setInputFile</a></h3>
   <div class="memberName">public  void setInputFile(String fileName)</div>
   <div class="memberDescription"> Sets up the streams and buffers for audio file input.
  If any Exception is thrown within this method, it is caught, and any
  opened streams are closed, and <code>pcmInputStream</code> is set to
  <code>null</code>, indicating that the method did not complete
  successfully.<p class="tag tag_param"><span class="tagName">Parameters:</span> <span class="tagContents">fileName The path name of the input audio file.</span> </p>
</div>


   <h3><a name="setLiveInput()" id="setLiveInput()">setLiveInput</a></h3>
   <div class="memberName">public  void setLiveInput()</div>
   <div class="memberDescription"> Sets up the streams and buffers for live audio input (CD quality).
  If any Exception is thrown within this method, it is caught, and any
  opened streams are closed, and <code>pcmInputStream</code> is set to
  <code>null</code>, indicating that the method did not complete
  successfully.</div>


   <h3><a name="setProgressCallback(at.ofai.music.beatroot.ProgressIndicator)" id="setProgressCallback(at.ofai.music.beatroot.ProgressIndicator)">setProgressCallback</a></h3>
   <div class="memberName">public  void setProgressCallback(<a href="ProgressIndicator.html" class="interfaceRef">ProgressIndicator</a> c)</div>
   <div class="memberDescription"> Adds a link to the GUI component which shows the progress of matching.<p class="tag tag_param"><span class="tagName">Parameters:</span> <span class="tagContents">c the AudioProcessor representing the other performance</span> </p>
</div>


   <h3><a name="toString()" id="toString()">toString</a></h3>
   <div class="memberName">public  String toString()</div>
   <div class="memberDescription"> Gives some basic information about the audio being processed.</div>


   <h3><a name="weightedPhaseDeviation()" id="weightedPhaseDeviation()">weightedPhaseDeviation</a></h3>
   <div class="memberName">protected  void weightedPhaseDeviation()</div>
   <div class="memberDescription"> Calculates the weighted phase deviation onset detection function.
  Not used.
  TODO: Test the change to WPD fn</div>

   
   <div class="navbar">
    <p class="nav navtop">
      <span class="over"><a href="../../../../overview-summary.html">Overview</a></span>
      <span class="package"><a href="package-summary.html">Package</a></span>
      <span class="class selected">Class</span>
      <span class="use"><a href="class-use/AudioProcessor.html">Use</a></span>
      <span class="tree"><a href="package-tree.html">Tree</a></span>
      <span class="deprecated"><a href="../../../../deprecated-list.html">Deprecated</a></span>
      <span class="index"><a href="../../../../index-all.html">Index</a></span>
      <span class="help"><a href="../../../../help-doc.html">Help</a></span>
    </p>
    <p class="nav navmid">
      <span class="prevnext">
       <span class="prev">Prev Class</span>
       <span class="next">Next Class</span>
      </span>
      <span class="framesel">
       <span class="frames"><a href="../../../../index.html" target="_top">Frames</a></span>
       <span class="noframes"><a href="AudioProcessor.html" target="_top">NoFrames</a></span>
      </span>
      <span class="allclasses"><a href="../../../../allclasses-noframe.html">All Classes</a></span>
   </p>
   <p class="nav navbot">
      <span class="summary">Summary:
       <span class="nested">Nested</span>
       <span class="field"><a href="#field_summary">Field</a></span>
       <span class="constr"><a href="#constructor_summary">Constr</a></span>
       <span class="method"><a href="#method_summary">Method</a></span>
      </span>
      <span class="detail">Detail:
       <span class="field"><a href="#field_detail">Field</a></span>
       <span class="constr"><a href="#constructor_detail">Constr</a></span>
       <span class="method"><a href="#method_detail">Method</a></span>
      </span>
   </p>
    <div class="navtitle">
     
    </div>
    <p class="clear"><!--empty--></p>
   </div>
   <div class="bottom"></div>
   </body>
</html>
